[Interface]
Address = ${CLIENT_IP}
PrivateKey = $(cat /config/${PEER_ID}/privatekey-${PEER_ID})
DNS = ${PEERDNS}

# Enable for server to peer communication
#PostUp = sudo iptables --table nat --append POSTROUTING --jump MASQUERADE --protocol all --out-interface <SYSTEM INTERFACE NAME>+ --source <WIREGUARD SERVER INTERFACE IP> --destination 0.0.0.0/0 --match comment --comment "Allow WireGuard server to peer communication"
#PostDown = sudo iptables --table nat --delete POSTROUTING --jump MASQUERADE --protocol all --out-interface <SYSTEM INTERFACE NAME>+ --source <WIREGUARD SERVER INTERFACE IP> --destination 0.0.0.0/0 --match comment --comment "Allow WireGuard server to peer communication"

# Enable if filter table FORWARD policy is set to DROP
PostUp = sudo iptables --table filter --append FORWARD --jump ACCEPT --protocol all --in-interface peer_vslab --out-interface ens+ --source 10.11.1.1/32 --destination 0.0.0.0/0 --match conntrack --ctstate "NEW,ESTABLISHED" --match comment --comment "Allow WireGuard server to peer communication"
PostUp = sudo iptables --table filter --append FORWARD --jump ACCEPT --protocol all --in-interface ens+ --out-interface peer_vslab --source 0.0.0.0/0 --destination 10.11.1.1/32 --match conntrack --ctstate "ESTABLISHED" --match comment --comment "Allow WireGuard server to peer communication"

PostDown = sudo iptables --table filter --append FORWARD --jump ACCEPT --protocol all --in-interface peer_vslab --out-interface ens+ --source 10.11.1.1/32 --destination 0.0.0.0/0 --match conntrack --ctstate "NEW,ESTABLISHED" --match comment --comment "Allow WireGuard server to peer communication"
PostDown = sudo iptables --table filter --append FORWARD --jump ACCEPT --protocol all --in-interface ens+ --out-interface peer_vslab --source 0.0.0.0/0 --destination 10.11.1.1/32 --match conntrack --ctstate "ESTABLISHED" --match comment --comment "Allow WireGuard server to peer communication"


[Peer]
PublicKey = $(cat /config/server/publickey-server)
PresharedKey = $(cat /config/${PEER_ID}/presharedkey-${PEER_ID})
Endpoint = ${SERVERURL}:${SERVERPORT}
AllowedIPs = ${ALLOWEDIPS}
PersistentKeepalive = 25
